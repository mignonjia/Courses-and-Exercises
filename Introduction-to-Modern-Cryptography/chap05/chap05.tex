\documentclass[a4paper]{article}
 \usepackage[margin=1in]{geometry} 
\usepackage{amsmath,amsthm,amssymb,amsfonts}
\usepackage{graphicx} 

\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}

\newcommand{\negl}{\text{negl}}
\newcommand{\Enc}{\text{Enc}}
\newcommand{\Dec}{\text{Dec}}
\newcommand{\Gen}{\text{Gen}}
\newcommand{\Mac}{\text{Mac}}
\newcommand{\Vrfy}{\text{Vrfy}}
\newcommand{\Func}{\text{Func}}
\newcommand{\Perm}{\text{Perm}}
\newcommand{\Getvrfy}{\text{Get-Vrfy}}
\newcommand{\hash}{\text{Hash}}
\newcommand{\hashsec}{\text{Hash-sec}}
\newcommand{\hashprei}{\text{Hash-prei}}
\newcommand{\hashcoll}{\text{Hash-coll}}
\newcommand{\vrfyfile}{\text{Vrfy-file}}
\newcommand{\myn}{l_{in}(n)}
\newcommand{\C}{\mathcal{C}}
\newcommand{\K}{\mathcal{K}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\h}{\mathcal{H}}
\newcommand{\V}{\mathcal{V}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\OO}{\mathcal{O}}

\newenvironment{problem}[2][Problem]{\begin{trivlist}
\item[\hskip \labelsep {\bfseries #1}\hskip \labelsep {\bfseries #2.}]}{\end{trivlist}}
%If you want to title your bold things something different just make another thing exactly like this but replace "problem" with the name of the thing you want, like theorem or lemma or whatever
 
\begin{document}
%\renewcommand{\qedsymbol}{\filledbox}
%Good resources for looking up how to do stuff:
%Binary operators: http://www.access2science.com/latex/Binary.html
%General help: http://en.wikibooks.org/wiki/LaTeX/Mathematics
%Or just google stuff
 
\title{Chapter 05}
\author{Mingjia Huo}
\date{}
\maketitle

\begin{problem}{5.1}
$ $\par
Formal definition of \textbf{second preimage resistance}:\par
The collision-finding experiment $\hashsec_{\A,\Pi}(n)$:\par\begin{enumerate}
    \item A key $s$ is generated by running $\Gen(1^n)$. Then uniformly choose $x\in\{0,1\}^*$. (If $\Pi$ is a fixed-length hash function for inputs of length $l'(n)$, then require $x\in\{0,1\}^{l'(n)}$.)
    \item Then adversary $\A$ is given $s,x$. Then $\A$ outputs $x'\in\{0,1\}^*$.(If $\Pi$ is a fixed-length hash function for inputs of length $l'(n)$, then require $x\in\{0,1\}^{l'(n)}$.)
    \item The output of the experiment is defined to be $1$ is and only if $x\ne x'$ and $H^s(x')=H^s(x)$. In such a case we say that $\A$ has found a collision.
    \end{enumerate}
    \begin{definition}
    A hash function $\Pi=(\Gen,H)$ is second preimage resistance if for all \texttt{PPT} adversary $\A$, there is a $\negl(n)$ such that \[\Pr[\hashsec_{\A,\Pi}(n)=1]\le\negl(n).\]
    \end{definition}\par\vspace{3ex}
    
Formal definition of \textbf{preimage resistance}:\par
The collision-finding experiment $\hashprei_{\A,\Pi}(n)$:\par\begin{enumerate}
    \item A key $s$ is generated by running $\Gen(1^n)$. Then uniformly choose $x\in\{0,1\}^*$. (If $\Pi$ is a fixed-length hash function for inputs of length $l'(n)$, then require $x\in\{0,1\}^{l'(n)}$.) Compute $y=H^s(x)$.
    \item Then adversary $\A$ is given $s,y$. Then $\A$ outputs $x'\in\{0,1\}^*$.(If $\Pi$ is a fixed-length hash function for inputs of length $l'(n)$, then require $x\in\{0,1\}^{l'(n)}$.)
    \item The output of the experiment is defined to be $1$ is and only if $y=H^s(x')$. In such a case we say that $\A$ has found a collision.
    \end{enumerate}
    \begin{definition}
    A hash function $\Pi=(\Gen,H)$ is preimage resistance if for all \texttt{PPT} adversaries $\A$, there is a $\negl(n)$ such that \[\Pr[\hashprei_{\A,\Pi}(n)=1]\le\negl(n).\]
    \end{definition}\par\vspace{3ex}
    
Proof of collision resistant to second preimage resistant: Proof by contradiction, assume $\Pi=(\Gen, H)$ is not second preimage resistant but is collision resistant, so there's an \texttt{PPT} adversary $\A'$, such that \[\Pr[\hashsec_{\A',\Pi}(n)=1]>\negl(n).\]
Construct an experiment for \texttt{PPT} adversary $\A$:
\begin{enumerate}
    \item A key $s$ is generated by running $\Gen(1^n)$.
    \item Then adversary $\A$ is given $s$. Then $\A$ uniformly chooses $x\in\{0,1\}^*$ and gives $A'$ $s$ and $x$.
    \item When $\A'$ outputs $x'\in\{0,1\}^*$, $\A$ outputs $x,x'$.
    \item The output is $1$ if and only if $x\ne x', H^s(x)=H^s(x')$.
    (If $\Pi$ is a fixed-length hash function for inputs of length $l'(n)$, then require $x,x'\in\{0,1\}^{l'(n)}$.)
\end{enumerate}
So $\A$ outputs $1$ $\Leftrightarrow$ $x\ne x'$ and $H^s(x)=H^s(x')$ $\Leftrightarrow$ $\A'$ outputs $1$.\par
Thus $\Pr[\hashcoll_{\A,\Pi}(n)=1]=\Pr[\hashprei_{\A',\Pi}(n)=1]>\negl(n)$, a contradiction.\par\vspace{3ex}

Proof of second preimage resistant to preimage resistant: Proof by contradiction, assume $\Pi=(\Gen, H)$ is not preimage resistant but is second preimage resistant, so there's an \texttt{PPT} adversary $\A'$, such that \[\Pr[\hashprei_{\A',\Pi}(n)=1]>\negl(n).\]
Construct an experiment for \texttt{PPT} adversary $\A$:
\begin{enumerate}
    \item A key $s$ is generated by running $\Gen(1^n)$. Then uniformly choose $x\in\{0,1\}^*$.
    \item Then adversary $\A$ is given $s,x$. Compute $y=H^s(x)$. Then, gives $A'$ $s$ and $y$.
    \item When $\A'$ outputs $x'\in\{0,1\}^*$, $\A$ outputs $x'$.
    \item The output is $1$ if and only if $x\ne x', H^s(x)=H^s(x')$.
    (If $\Pi$ is a fixed-length hash function for inputs of length $l'(n)$, then require $x,x'\in\{0,1\}^{l'(n)}$.)
\end{enumerate}
So $\A'$ outputs $1$ $\Leftrightarrow$ $H^s(x)=H^s(x')$, and $\A$ outputs $1$ $\Leftrightarrow$ $x\ne x',H^s(x)=H^s(x')$ .\par
Denote set $W=\{x\mid y=H^s(x)\text{ has only one x hashed to y.}\}$, since $y\in\{0,1\}^{l(n)}$, we have $|W|\le 2^{l(n)}$.
Consider the probability that $x\ne x'$ when $H^s(x)=H^s(x')$, here we assume $2^{l(n)-l'(n)}\le\negl(n)$, where $l(n)=len(y),l'(n)=len(x)$:
\begin{align*}
    &\Pr[x\ne x'\land H^s(x)=H^s(x')]\\
    =&\Pr[x\ne x'\land H^s(x)=H^s(x')\land x\not\in W]\\
    =&\Pr[H^s(x)=H^s(x')]-\Pr[H^s(x)=H^s(x')\land x\in W]-\Pr[x=x'\land H^s(x)=H^s(x')\land x\not\in W]\\
    =&\Pr[H^s(x)=H^s(x')]-0-\Pr[x=x'\land H^s(x)=H^s(x')\mid x\not\in W ]\times\Pr[x\not\in W]\\
    \ge&\Pr[H^s(x)=H^s(x')]-\frac12\Pr[H^s(x)=H^s(x')]\times(1-2^{l(n)-l'(n)})\\
    =&\frac12\Pr[H^s(x)=H^s(x')]-\negl(n)
\end{align*}
Since $\Pr[H^s(x)=H^s(x')]>\negl(n)$, we have $\Pr[\hashsec_{\A,\Pi}(n)=1]=\Pr[x\ne x'\land H^s(x)=H^s(x')]>\negl(n),$ a contradiction.\par\vspace{2ex}
\textbf{Refute:} If we remove the condition that $2^{l(n)-l'(n)}\le\negl(n)$, then second preimage resistant can not imply preimage resistant. A construction is as followed: assume there is a second preimage resistant $H':\{0,1\}^{n+1}\rightarrow\{0,1\}^n$, then 
		\begin{equation*}  
			H(x)= \begin{cases}
					0x_3\cdots x_{n+1}, & x_1=x_2=0 \\  
					1H'(x_1\cdots x_{n+1}), & otherwise  
				\end{cases} 
		\end{equation*}
$H(x)$ is second preimage resistant. But there is probability $\frac14$ that given $y$, $\A$ can invert $x$. So it not implies preimage resistant.
\end{problem}

\begin{problem}{5.2}
(a).
Assume $\Pi_1=(\Gen_1, H_1)$ is collision resistant. For arbitrary $\A$ of $\Pi=(\Gen,H)$, construct an experiment for \texttt{PPT} adversary $\A_1$ of $\Pi_1=(\Gen_1,H_1)$ based on it:\begin{enumerate}
    \item A key $s_1$ is generated by running $\Gen(1^n)$.
    \item Then adversary $\A_1$ is given $s_1$. Run $\Gen_2(1^n)$ and get $s_2$.
    \item $\A_1$ gives $s_1,s_2$ to $\A$, then $\A$ outputs $x,x'$.
    \item $\A_1$ outputs $x,x'$.
    \item The output is $1$ if and only if $H_1^{s_1}(x)=H_1^{s_1}(x')$.
\end{enumerate}
Here, $\A$ succeeds $\Leftrightarrow$ $H_1^{s_1}(x)\|H_2^{s_2}(x)=H_1^{s_1}(x')\|H_2^{s_2}(x')\Rightarrow H_1^{s_1}(x)=H_1^{s_1}(x')$ $\Leftrightarrow$ $\A_1$ succeeds. Thus,
\[\Pr[\hashcoll_{\A,\Pi}(n)=1]\le \Pr[\hashcoll_{\A_1,\Pi_1}(n)=1]\le\negl(n).\]
So $\Pi=(\Gen, H)$ is collision resistant.\par
\vspace{3ex}
(b).
It holds for second preimage resistant.\par
Assume $\Pi_1=(\Gen_1, H_1)$ is second preimage resistant. Assume all the theme are fixed-length with input length $l'(n)$. 
For arbitrary $\A$ of $\Pi(\Gen,H)$, construct an experiment for \texttt{PPT} adversary $\A_1$ of $\Pi_1(\Gen_1,H_1)$ based on it:\begin{enumerate}
    \item A key $s_1$ is generated by running $\Gen(1^n)$, uniformly choose $x\in\{0,1\}^{l'(n)}$.
    \item Then adversary $\A_1$ is given $s_1,x$. Run $\Gen_2(1^n)$ and get $s_2$.
    \item $\A_1$ gives $s_1,s_2,x$ to $\A$, then $\A$ outputs $x'\in\{0,1\}^{l'(n)}$.
    \item $\A_1$ outputs $x'$.
    \item The output is $1$ if and only if $x\ne x',H_1^{s_1}(x)=H_1^{s_1}(x')$.
\end{enumerate}
Here, $\A$ succeeds $\Leftrightarrow$ $H_1^{s_1}(x)\|H_2^{s_2}(x)=H_1^{s_1}(x')\|H_2^{s_2}(x')\Rightarrow H_1^{s_1}(x)=H_1^{s_1}(x')$ $\Leftrightarrow$ $\A_1$ succeeds. Thus,
\[\Pr[\hashsec_{\A,\Pi}(n)=1]\le \Pr[\hashsec_{\A_1,\Pi_1}(n)=1]\le\negl(n).\]
So $\Pi=(\Gen, H)$ is second preimage resistant.\par\vspace{3ex}
It doesn't hold for preimage resistant.\par
Construct $\Pi_2=(\Gen_2,H_2)$ as followed:
\begin{enumerate}
    \item $\Gen_2$: do nothing.
    \item $H_2$: on input $x=\{0,1\}^{n+1}$, output first $n$ bits of $x$ as $H_2(x)$.
\end{enumerate}
Thus, in the experiment of preimage resistant: on input $y$, we first define the last $n$ bits as $y_2$, then simply add a uniformly bit $b\in\{0,1\}$ after $y_2$, define as $x$. Then with probability $\frac12$, the adversary succeeds. \par
Thus, although $\Pi_1$ is preimage resistant, it doesn't work for $\Pi$.
\end{problem}
\begin{problem}{5.3}
Yes.\par
For arbitrary $\A$ of $\Pi=(\Gen,\hat{H})$, construct an experiment for \texttt{PPT} adversary $\A'$ of $\Pi'=(\Gen,H)$ based on it:\begin{enumerate}
    \item A key $s$ is generated by running $\Gen(1^n)$.
    \item Then adversary $\A'$ is given $s$. $\A'$ gives $s$ to $\A$, then $\A$ outputs $x,x'\in\{0,1\}^{*}$.
    \item $\A'$ checks: if $H^s(x)\ne H^s(x')$, let $x=H^s(x), x'=H^s(x')$. Then $\A'$ output $x,x'$.
    \item The output is $1$ if and only if $x\ne x',H^{s}(x)=H^{s}(x')$.
\end{enumerate}
In the experiment, if $\A$ succeeds, then $x\ne x'$ and $H^{s}(H^{s}(x))=H^{s}(H^{s}(x'))$. If $H^{s}(x)=H^{s}(x')$, then $x, x'$ succeeds for $\A$; otherwise we have $H^{s}(x)\ne H^{s}(x')$ and $H^{s}(H^{s}(x))=H^{s}(H^{s}(x'))$, so $H^{s}(x),H^{s}(x')$ succeeds for $\A$. \par
Thus,\[\Pr[\hashcoll_{\A,\Pi}(n)=1]=\Pr[\hashcoll_{\A',\Pi'}(n)=1]\le\negl(n)\]
The inequality holds because $\Pi'=(\Gen,H)$ is collision resistant. So $\Pi=(\Gen,\hat{H})$ is collision resistant.
\end{problem}
\begin{problem}{5.6}
Before answering the questions, prove claim: if hash function $h:\{0,1\}^{2n}\rightarrow \{0,1\}^{n}$ is collision resistant, then construct $H$ as followed:\[\forall x\in\{0,1\}^{2n},s, H^s(x)=h^s(x)\oplus c_s.\]
Then $H$ is collision resistant. (Here $c_s\in\{0,1\}^n$.)\par
\begin{proof}
For arbitrary $\A$ of $\Pi=(\Gen,H)$, construct an experiment for \texttt{PPT} adversary $\A'$ of $\Pi'=(\Gen,h)$ based on it:\begin{enumerate}
    \item A key $s$ is generated by running $\Gen(1^n)$.
    \item Then adversary $\A'$ is given $s$. Then $\A'$ gives $s$ to $\A$, \item When $\A$ outputs $x,x'\in\{0,1\}^{2n}$, $\A'$ outputs $x,x'$.
    \item The output is $1$ if and only if $x\ne x',H^{s}(x)=H^{s}(x')$.
\end{enumerate}
Here, 
\begin{align*}
    \hashcoll_{\A',\Pi'}=1&\Leftrightarrow H^{s}(x)=H^{s}(x')\\
    &\Leftrightarrow h^{s}(x)\oplus h^{s}(0^n\|c_s)=h^{s}(x')\oplus h^{s}(0^n\|c_s)\\
    &\Leftrightarrow h^{s}(x)=h^{s}(x')\\
    &\Leftrightarrow\hashcoll_{\A,\Pi}=1
\end{align*}
Thus, $H$ is collision resistant.
\end{proof}

(a).No.\par
Fixed $x_0\in \{0,1\}^{n}$ Given hash function $h$, construct $H$ as followed:\par
$$\forall x\in\{0,1\}^{2n},s, H^s(x)=h^s(x)\oplus h^s(0^n\|x_0).$$
Thus, $$\forall s, H^s(0^n\|x_0)=0^n.$$
For the claim we prove above, $H$ is collision resistant.\par
Use $H$ as the hash block in Merkle-Damg\aa rd transform and define as $H_m$, we have $$H_m(x_0\|x_0)=H(0^n\|x_0)=0^n=H_m(x_0),$$ a collision.\par
So it's not collision resistant.\par\vspace{3ex}
(b).Yes.\par
Proof by contradiction: If there are $x\ne x'$, such that $$H^s(x)=z_B\|L=z_{B'}'\|L'=H^s(x'),$$ we have $L=L'$. 
Assume $x=x_1\cdots x_B,x'=x_1'\cdots x_B'$.\par
Let $I_i=z_{i-1}\|x_i$ denote the $i$th input to $h^s$, and set $I_{B+1}=z_{B}$. Define $I_i'$ analogously with respect to $x'$. \par
Let $N$ be the largest index of $\{1,2\cdots,B\}$, such that $I_N\ne I_N'$. Since $x\ne x'$, there exists such $N$. \par
By the maximization of $N$, we have $I_{N+1}=I_{N+1}'$, that is $z_N=z_N'$. However, $I_N\ne I_N'$. So we find a collision in $h^s$. \par
But $h^s$ is collision resistant, a contradiction.
So it's collision resistant.\par\vspace{3ex}
(c).Yes.\par
Proof by contradiction: If there are $x\ne x'$, such that $$H^s(x)=z_B\|L=z_{B'}'\|L'=H^s(x'),$$ we have $L=L'$. 
Assume $x=x_1\cdots x_B,x'=x_1'\cdots x_B'$.\par
Let $I_i=z_{i-1}\|x_i$ denote the $i$th input to $h^s$, and set $I_{B+1}=z_{B}$. Define $I_i'$ analogously with respect to $x'$. \par
Let $N$ be the largest index of $\{1,2\cdots,B\}$, such that $I_N\ne I_N'$. Since $x\ne x'$, there exists such $N$. \par
\begin{itemize}
    \item $N>1$: By the maximization of $N$, we have $I_{N+1}=I_{N+1}'$, that is $z_N=z_N'$. However, $I_N\ne I_N'$. So we find a collision in $h^s$.
    \item $N=1$: $I_2=I_2'\Rightarrow z_1=z_1'$, and $I_1\ne I_1'$. we find a collision.
\end{itemize}
But $h^s$ is collision resistant, a contradiction.
So it's collision resistant.\par\vspace{3ex}
(d).No.\par
Fixed $x_0\in \{0,1\}^{n}$ Given hash function $h$, construct $H$ as followed:\par
$$\forall x\in\{0,1\}^{2n},s, H^s(x)=h^s(x)\oplus h^s(2L\|x_0)\oplus L.$$
Thus, $$\forall s, H^s(2L\|x_0)=L.$$
For the claim we prove above, $H^s$ is collision resistant.\par
Use $H^s$ as the hash block in Merkle-Damg\aa rd transform and define as $H_m^s$, we have $$H_m^s(x_0\|x_0)=H^s(H^s(2L\|x_0)\|x_0)=H^s(L\|x_0)=H_m^s(x_0),$$ a collision.\par
So it's not collision resistant.
\end{problem}
\begin{problem}{5.10(a)}
Randomly choose $m$, the adversary $\A$ access the oracle $\Mac_{s,k}(\cdot)=H^s(k\|\cdot)$ and get $t$. 
Let $m'$ denotes the message after padding $m$ and adding the string length. So $m'$ is exactly the input of hash function.\par
Assume $L=|m'|$. Then $\A$ compute $h^s(t\|L)=t'$, and output $(m',t')$. 
Since $$H^s(m')=h^s(m'\|L)=h^s(h^s(m)\|L)=h^s(t\|L)=t',$$ we have 
$\Vrfy_k(m',t')=1$ and $(m',t')$ was not asked by $\A$.\par
Thus $\A$ succeeds with probability $1$. And it's not a secure $\Mac$.
\end{problem}
\begin{problem}{5.13}
If $t$ is not a power of $2$, use an incomplete binary tree. To construct a collision, first randomly choose $(x_1',\cdots,x_{2t}')$. Get its Merkle tree construction: define the hash values in the first step as $(H(x_1',x_2'),\cdots,H(x_{2t-1}',x_{2t}'))$. Then define $(x_1,x_2,\cdots,x_t)=(H(x_1',x_2'),\cdots,H(x_{2t-1}',x_{2t}'))$. \par
Thus, $\mathcal{MT}_t(x_1,x_2,\cdots,x_t)=\mathcal{MT}_{2t}(x_1',x_2',\cdots,x_{2t}')$.
\end{problem}

\begin{problem}{5.14}
\textbf{(a).}\par
Assume $\F,\V,\h$ denotes the set of files, verify codes and the messages saved by clients.
A setting $\Pi=(\hash,\Getvrfy,\Vrfy)$ is contained of:
\begin{itemize}
    \item $H$: $\F^*\rightarrow\h$. Given file set $F\subset\F$, the function return a value $h$ that should be saved by the client.
    \item $\Getvrfy$: $\F\rightarrow\V$. When a client wants to verify the exists of $f\in\F$, the function return $v\in \V$ for the client to check.
    \item $\Vrfy$: $\F\times\V\rightarrow\{0,1\}$. Return if the file $f\in\F$ can be verified by $v\in\V$.
\end{itemize}
Experiment Verify-file $\Pi=(\hash,\Getvrfy,\Vrfy)$ of an \texttt{PPT} adversary $\A$:
\begin{enumerate}
    \item Run $\A(1^n)$. $\A$ is given $\Pi=(\hash,\Getvrfy,\Vrfy)$.
    \item $\A$ outputs $f,v$.
    \item Output $1$ if and only if $\Vrfy(f,v)=1$ and $v\ne\Getvrfy(f)$.
\end{enumerate}
\begin{definition}
The files that the client saves on the server are \textbf{secure} if and only if 
\[\Pr[\vrfyfile_{\A,\Pi}(n)=1]\le\negl(n).\]
\end{definition}\par\vspace{3ex}
\textbf{(b).}\par
The Merkle trees' construction $\Pi=(\hash,\Getvrfy,\Vrfy)$ is as followed:
\begin{itemize}
    \item $\hash=h^s$: Given file set $F=\{f_1,\cdots,f_n\}$. Assume $2^{t-1}<n\le2^{t}$, then set $f_{n+1}=\cdots=f_{2^t}=\text{null}$. Let $n'=2^t$.\begin{itemize}
        \item Use hash function $h^s$ to compute $h^s(f_1,f_2),\cdots,h^s(f_{n'-1},f_{n'})=h_{1,2},\cdots,h_{n'-1,n'}$.
        \item $h^s(h_{1,2},h_{3,4}),\cdots,h^s(h_{n'-3,n'-2},h_{n'-1,n'})=h_{1\cdots4},\cdots,h_{n'-3\cdots n'}$.\par
        $\cdots$\par
        \item $h^s(h_{1\cdots n'/2},h_{n'/2+1\cdots n'})=h_{n'/2+1\cdots n'}=h$
    \end{itemize}
    Then the server save all hash values and give $h$ to the client.
    \item $\Getvrfy$: The client wants to verify $x_i$. Without loss of generality, assume $i=1$. Then the server give him $x_2, h_{3,4}, h_{5\cdots 8},\cdots, h_{n'/2+1\cdots n'}$.\par
    (That is, give the client the other child nodes along the binary tree, such that the client can use these values to compute $h$.)
    \item $\Vrfy$: Without loss of generality, assume the client wants to verify $x_1$. The client computes $h^s(h^s(\cdots(h^s(x_1,h_{3,4})\cdots),h_{n'/2+1\cdots n'})$ equals to $h$ or not.\par
    If so, the verification succeeds; otherwise, the verification fails.
\end{itemize}\par\vspace{3ex}

\textbf{(c).}\par
If $\Pi'=(\Gen_h,h)$ is collision resistant, then $\forall \A'$, 
\[\Pr[\hashcoll_{\A',\Pi'}(n)=1]\le\negl(n).\]
Assume an adversary $\A$ has find a collision in Merkle trees $\Pi=(h,\Getvrfy,\Vrfy)$. Then we construct an adversary $\A'$ to find a collision in $h^s$.\par 
To write succinctly, if client asks to verify $x_i$, denotes the values that the server gives as $(h_1,h_2,\cdots,h_t)$. Denote $x_i$ as $h_0$.
The client should compute:
\begin{align*}
    h^s(h_0,h_1)&=h_1'\\
    h^s(h_1',h_2)&=h_2'\\
    &\cdots\\
    h^s(h_{t-1}',h_t)&=h_t'
\end{align*}
Then verify if $h_t'=h$.\par
Assume $v=(h_1,h_2,\cdots,h_t)$ are generated by the correct files. If there are $v^0=(h_1^0,h_2^0,\cdots,h_t^0)\ne v$, such that $\Vrfy(v')=1$, we say there is a collision in the construction based on Merkle trees.\par
Define 
\begin{align*}
    &I_1=(h_0,h_1)\\
    &I_2=(h_1',h_2)\\
    &\cdots\\
    &I_t=(h_{t-1}',h_t)\\
    &I_{t+1}=h_t'
\end{align*}
Similarly, define $I_1^0,\cdots,I_{t+1}^0$. Let $N$ be the largest index such that $I_N\ne I_N^0$. Since $v\ne v^0$ï¼Œthere exists $h_i\ne h_i^0$, and exists $I_i\ne I_i^0$, so such $N$ exists.\par
Since $h_t'=h={h_t^0}'$, $I_{t+1}=I_{t+1}^0$. Thus $N\le t$.\par
For the maximization of $N$, we have $I_{N+1}=I_{N+1}^0$, so $h_{N}'={h_N^0}'$. But $(h_{N-1}',h_N)=I_i\ne I_i^0=({h_{N-1}^0}',h_N^0)$, and there hash value $h_{N}'={h_N^0}'$, thus we find a collision in $h^s$. \par
Thus a collision in Merkle trees $\Rightarrow$ a collision in $h^s$:
\[\Pr[\vrfyfile_{\A,\Pi}(n)=1]\le\Pr[\hashcoll_{\A',\Pi'}(n)=1]\le\negl(n).\]
Thus, the construction based on Merkle trees is secure.
\end{problem}
\end{document}

